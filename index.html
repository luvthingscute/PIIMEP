<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Visualizador PIIMEP Quilpué</title>

<link rel="stylesheet"
 href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
html, body {margin:0; padding:0;}
#map {width:100vw; height:100vh;}
</style>
</head>

<body>
<div id="map"></div>

<script>

const map = L.map('map').setView([-33.05, -71.45], 12);

L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{
 attribution:'©OpenStreetMap ©Carto'
}).addTo(map);

// ----------------------
// COLORES POR TIPO
// ----------------------
function colorPorTipo(t){
 if(!t) return "#BDBDBD";
 t = t.toLowerCase();
 if(t.includes("movilidad")) return "#f3cb44";
 if(t.includes("integral")) return "#eb9890";
 if(t.includes("espacio")) return "#abd4a0";
 return "#BDBDBD";
}

// ----------------------
// COMUNA
// ----------------------
fetch("data/COMUNA.geojson")
.then(r=>r.json())
.then(data=>{
 L.geoJSON(data,{
   style:{
     color:"#7c0a6e",
     weight:2,
     fillOpacity:0
   }
 }).addTo(map);
});

// ----------------------
// UT
// ----------------------
fetch("data/UT_QUILPUE.geojson")
.then(r=>r.json())
.then(data=>{
 L.geoJSON(data,{
   style:{
     color:"#7a0f3a",
     weight:1.5,
     fillOpacity:0
   }
 }).addTo(map);
});

// ----------------------
// POLIGONOS
// ----------------------
fetch("data/poligonos.geojson")
.then(r=>r.json())
.then(data=>{
 L.geoJSON(data,{
   style:f=>({
     color: colorPorTipo(f.properties.Tipo_de_pr),
     fillColor: colorPorTipo(f.properties.Tipo_de_pr),
     weight:2,
     fillOpacity:0.5
   }),
   onEachFeature:(f,l)=>{
     l.bindPopup(
       `<b style="color:${colorPorTipo(f.properties.Tipo_de_pr)}">
       Proyecto</b><br>
       <b>Tipo:</b> ${f.properties.Tipo_de_pr || "Sin dato"}<br>
       <b>Nombre:</b> ${f.properties.Nombre_de_ || "Sin nombre"}`
     );
   }
 }).addTo(map);
});

// ----------------------
// LINEAS
// ----------------------
fetch("data/lineas3.geojson")
.then(r=>r.json())
.then(data=>{
 L.geoJSON(data,{
   style:f=>({
     color: colorPorTipo(f.properties.Tipo_de_pr),
     weight:4
   }),
   onEachFeature:(f,l)=>{
     l.bindPopup(
       `<b style="color:${colorPorTipo(f.properties.Tipo_de_pr)}">
       Proyecto</b><br>
       <b>Tipo:</b> ${f.properties.Tipo_de_pr || "Sin dato"}<br>
       <b>Nombre:</b> ${f.properties.Nombre_de_ || "Sin nombre"}`
     );
   }
 }).addTo(map);
});

// ----------------------
// PUNTOS
// ----------------------
fetch("data/puntos2.geojson")
.then(r=>r.json())
.then(data=>{
 L.geoJSON(data,{
   pointToLayer:(f,latlng)=>{
     return L.circleMarker(latlng,{
       radius:6,
       color: colorPorTipo(f.properties.Tipo_de_pr),
       fillColor: colorPorTipo(f.properties.Tipo_de_pr),
       fillOpacity:0.9
     });
   },
   onEachFeature:(f,l)=>{
     l.bindPopup(
       `<b style="color:${colorPorTipo(f.properties.Tipo_de_pr)}">
       Proyecto</b><br>
       <b>Tipo:</b> ${f.properties.Tipo_de_pr || "Sin dato"}<br>
       <b>Nombre:</b> ${f.properties.Nombre_de_ || "Sin nombre"}`
     );
   }
 }).addTo(map);
});

</script>
</body>
</html>

